<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.jeogiyo.review.dao.ReviewDAO">

	<resultMap id="reviewResult" type="reviewVO">
		<result property="reviewId" column="review_id" />
		<result property="shopId" column="shop_id" />
		<result property="shopName" column="shop_name" />
		<result property="starPoint" column="star_point" />
		<result property="content" column="content" />
		<result property="regDate" column="reg_date" />
		<result property="memberId" column="member_id" />
		<result property="memberType" column="member_type" />
		<result property="orderId" column="order_id" />
		<result property="rnum" column="rnum" />
	</resultMap>
	

	

	<insert id="insertReview" parameterType="reviewVO">

		<![CDATA[
			insert into J_REVIEW(SHOP_ID,SHOP_NAME,STAR_POINT,CONTENT,MEMBER_ID,MEMBER_TYPE,ORDER_ID)
			values(
			       #{shopId},#{shopName},#{starPoint},#{content},#{memberId},#{memberType},#{orderId}
				  )
		]]>
	</insert>

	<select id="selectCurrentReviewIdSequence" resultType="int">
		<![CDATA[
		SELECT SEQ_J_REVIEW_ID.CURRVAL
		FROM DUAL
		]]>
	</select>

	<insert id="insertReviewImage" parameterType="reviewImageVO">
		<![CDATA[
		insert into J_REVIEW_IMAGE(REVIEW_ID,FILE_NAME)
		values(
				  #{reviewId},#{fileName}
			  )
		]]>
	</insert>

	<select id="selectCurrentReviewImageIdSequence" resultType="int">
		<![CDATA[
		SELECT SEQ_J_REVIEW_IMAGE_ID.CURRVAL
		FROM DUAL
		]]>
	</select>

	<select id="selectReviewListCntByMember" resultType="int" parameterType="String">
		SELECT count(*)
		FROM J_REVIEW
		WHERE MEMBER_ID=#{memberId}
		  and MEMBER_TYPE=#{memberType}
	</select>

	<select id="selectReviewListByMemberAndPage" parameterType="java.util.Map" resultMap="reviewResult">
		SELECT RNUM, T.*
		FROM (
				 SELECT ROWNUM AS RNUM, J.*
				 FROM (
						  SELECT *
						  FROM J_REVIEW
						  WHERE member_id = #{memberId}
							and member_type = #{memberType}
						  ORDER BY REG_DATE DESC
					  ) J
			 ) T
		WHERE RNUM BETWEEN #{startList} + 1 AND #{endList} + 1
	</select>

</mapper>